{% extends "administrar/pestañas/base.html" %}
{% load partials %}
{% load utilidades %}

{% block contenido %}
  {% with titulo="Años académicos" descripcion="Gestiona las etapas que los estudiantes deben cursar para graduarse como bachiller" puede_añadir=perms.estudios.add_año puede_eliminar=perms.estudios.delete_año puede_editar=perms.estudios.change_año nombre_objeto="año" %}
    {{ block.super }}
  {% endwith %}
{% endblock contenido %}

{% block campos %}
  {% partial campos %}
{% endblock campos %}

{% block parcial_objeto %}
  {% partial año_objeto %}
{% endblock parcial_objeto %}

{% partialdef campos %}
  {# añadir nuevo año académico al agregarse correctamente #}
  {% if exito %}
    {% include "administrar/mensaje.html" with editado=editado objeto=objeto_retornado nombre_objeto="año" %}

    {% with objeto=objeto_retornado editado=editado reemplazar=1 %}
      {% partial año_objeto %}
    {% endwith %}
  {% endif %}

  {# se indica al obtener los campos con sus valores (a penas inicia la edición) o editar y producirse un error #}
  {% if not exito and objeto_retornado.id|es_entero %}
    <input type="hidden" name="id" value="{{ objeto_retornado.id }}" />
  {% endif %}

  {% for campo in form %}
    {% include "componentes/campo.html" with campo=campo class="elt elevado-2" %}
  {% endfor %}
{% endpartialdef campos %}

{% partialdef año_objeto %}
  {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
    {# Para cuando se añada con el formulario, poder añadirlo a la lista de objetos se genera este div con hx-swap-oob (ya que por alguna razón, al generar el parcial, se elimina el primer elemento, lo que provocaría que no se añada el <li>, sino directamente el <article>) #}
    {% if reemplazar %}
      <div 
        {% if editado %}
          hx-swap-oob="outerHTML:[data-id='{{ objeto.id }}']"
        {% else %}
          hx-swap-oob="beforeend:.lista-objetos"
        {% endif %}
      >
    {% endif %}
  {% comment %}<!-- prettier-ignore-end -->{% endcomment %}

  <li>
    <article
      data-id="{{ objeto.id }}"
      class="caja objeto"
      :data-seleccionado="seleccion.has('{{ objeto.id }}')"
      {% if añadido %}data-nuevo{% endif %}
    >
      <header class="cabecera">
        <h2 class="nombre">{{ objeto.nombre }}</h2>
        <ul class="estados">
          <li>
            <span class="id estado primario" role="status">
              <span>número:</span>
              <b>{{ objeto.numero }}</b>
            </span>
          </li>

          {% if añadido %}
            <li>
              <span class="estado nuevo" role="status">Nuevo</span>
            </li>
          {% endif %}
        </ul>
      </header>

      <dl class="info">
        <div class="grupo">
          <dt>Nombre corto</dt>
          <dd>{{ objeto.nombre_corto }}</dd>
        </div>

        <div class="grupo">
          <dt>Fecha de creación</dt>
          <dd>{{ objeto.fecha_creacion|date:"D. d M. Y, h:i A" }}</dd>
        </div>
      </dl>
    </article>
  </li>

  {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
    {% if reemplazar %}
      </div>
    {% endif %}
  {% comment %}<!-- prettier-ignore-end -->{% endcomment %}
{% endpartialdef año_objeto %}
