{% load widget_tweaks %}
{% load grupos_variantes %}
{% load utilidades %}
{% load partials %}

{% partialdef filtros %}
  <form
    class="flex flex-wrap gap-2"
    hx-trigger="click[verificarClickEnReiniciar()], change delay:800ms"
    hx-post
  >
    {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
      {% with 
        class="min-[500px]:min-w-150px incluido-filtros"
        prefijo_class="text-texto-sutil max-[500px]:has-[+:not(:empty)]:hidden"
        label_class="sr-only" 
        valor_class="max-[500px]:empty:hidden font-bold"
        placeholder="cualquiera"
      %}
        {% include "componentes/combobox.html" with
          name=form_filtros.notas_materias.name
          label=form_filtros.notas_materias.label
          prefijo=form_filtros.notas_materias.label
          opciones=form_filtros.notas_materias|obtener_lista_opciones
          opciones_seleccionadas=form_filtros.notas_materias.value
        %}

        {% include "componentes/combobox.html" with
          name=form_filtros.notas_secciones.name
          label=form_filtros.notas_secciones.label
          prefijo=form_filtros.notas_secciones.label
          opciones=form_filtros.notas_secciones.field.choices|obtener_lista_opciones
          opciones_seleccionadas=form_filtros.notas_secciones.value
        %}

        {% include "componentes/combobox.html" with
          name=form_filtros.notas_lapsos.name
          label=form_filtros.notas_lapsos.label
          prefijo=form_filtros.notas_lapsos.label
          opciones=form_filtros.notas_lapsos.field.choices|obtener_lista_opciones
          opciones_seleccionadas=form_filtros.notas_lapsos.value
        %}
      {% endwith %}
    {% comment %}<!-- prettier-ignore-end -->{% endcomment %}
  </form>
{% endpartialdef filtros %}

{% partialdef config %}
  <details
    name="config-submenu"
    x-data="{ abierto: false }"
    :open="abierto"
    @click.outside="abierto = false"
    @keydown.escape="abierto = false"
    class="menu submenu"
    hx-post
    {# se evita que se ejecute la request de "/notas" al cambiar los filtros específicos de búsqueda cuando el campo de búsqueda está vacío, ya que no tendría sentido, pues los resultados serían los mismos #}
    hx-trigger="change[$id('q').value.trim() !== ''] changed delay:600ms"
  >
    <summary class="flex aic gap-x-2" @click.prevent="abierto = !abierto">
      {% include "componentes/iconos/caret.html#izquierda" with class="size-5" %}
      Búsqueda
    </summary>

    <div class="contenido-menu p-4">
      <div class="col gap-y-1">
        {{ form_filtros.notas_tipo_busqueda.label_tag }}
        {% render_field form_filtros.notas_tipo_busqueda class="ui-elevado-2 incluido-filtros" %}
      </div>

      <div class="col gap-y-1">
        {{ form_filtros.notas_columna_buscada.label_tag }}
        {% render_field form_filtros.notas_columna_buscada class="ui-elevado-2 incluido-filtros" %}
      </div>
    </div>
  </details>

  <details
    name="config-submenu"
    x-data="{ abierto: false }"
    :open="abierto"
    @click.outside="abierto = false"
    @keydown.escape="abierto = false"
    class="menu submenu"
    hx-post
    hx-trigger="input changed delay:600ms"
  >
    <summary class="flex aic gap-x-2" @click.prevent="abierto = !abierto">
      {% include "componentes/iconos/caret.html#izquierda" with class="size-5" %}
      Valores de las notas
    </summary>

    <div class="contenido-menu p-4" hx-trigger="change changed" hx-post>
      <div class="flex gap-x-3 valor-nota">
        {{ form_filtros.notas_valor_minimo.label_tag }}
        {% render_field form_filtros.notas_valor_minimo class="ui-elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
      </div>

      <div class="flex gap-x-3 valor-nota">
        {{ form_filtros.notas_valor_maximo.label_tag }}
        {% render_field form_filtros.notas_valor_maximo class="ui-elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
      </div>
    </div>
  </details>

  <div
    class="flex gap-x-3 flex aic [&_label]:min-w-max"
    hx-vals='{"solo_tabla": true}'
  >
    {{ form_filtros.notas_cantidad_por_pagina.label_tag }}
    {% render_field form_filtros.notas_cantidad_por_pagina class="ui-elevado-2 incluido-filtros" style="max-width: 6ch;" hx-trigger="input changed delay:600ms" hx-post="" %}
  </div>
{% endpartialdef config %}
