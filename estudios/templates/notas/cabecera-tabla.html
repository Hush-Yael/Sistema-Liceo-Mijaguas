{% load widget_tweaks %}
{% load grupos_variantes %}
{% load utilidades %}
{% load partials %}

{% partialdef filtros %}
  <form
    class="flex flex-wrap gap-2"
    hx-trigger="click[verificarClickEnReiniciar()], change delay:800ms"
    hx-post
  >
    {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
      {% with 
        class="min-[500px]:min-w-150px incluido-filtros"
        prefijo_class="text-texto-sutil max-[500px]:has-[+:not(:empty)]:hidden"
        label_class="sr-only" 
        valor_class="max-[500px]:empty:hidden font-bold"
        placeholder="cualquiera"
        busqueda_activa=1
      %}
        {% include "componentes/combobox.html" with
          name=form_filtros.materias.name
          label=form_filtros.materias.label
          prefijo=form_filtros.materias.label
          opciones=form_filtros.materias|obtener_lista_opciones
          opciones_seleccionadas=form_filtros.materias.value
        %}

        {% include "componentes/combobox.html" with
          name=form_filtros.secciones.name
          label=form_filtros.secciones.label
          prefijo=form_filtros.secciones.label
          opciones=form_filtros.secciones.field.choices|obtener_lista_opciones
          opciones_seleccionadas=form_filtros.secciones.value
        %}

        {% include "componentes/combobox.html" with
          name=form_filtros.lapsos.name
          label=form_filtros.lapsos.label
          prefijo=form_filtros.lapsos.label
          opciones=form_filtros.lapsos.field.choices|obtener_lista_opciones
          opciones_seleccionadas=form_filtros.lapsos.value
        %}
      {% endwith %}
    {% comment %}<!-- prettier-ignore-end -->{% endcomment %}
  </form>
{% endpartialdef filtros %}

{% partialdef config %}
  <div
    class="col gap-y-4"
    hx-post
    {# se evita que se ejecute la request de "/notas" al cambiar los filtros específicos de búsqueda cuando el campo de búsqueda está vacío, ya que no tendría sentido, pues los resultados serían los mismos #}
    hx-trigger="change[$id('q').value.trim() !== ''] changed delay:600ms"
  >
    <div class="col gap-y-1">
      {{ form_filtros.tipo_busqueda.label_tag }}
      {% render_field form_filtros.tipo_busqueda class="ui-elevado-2 incluido-filtros" %}
    </div>

    <div class="col gap-y-1">
      {{ form_filtros.columna_buscada.label_tag }}
      {% render_field form_filtros.columna_buscada class="ui-elevado-2 incluido-filtros" %}
    </div>
  </div>

  <div class="col gap-y-4" hx-trigger="change changed" hx-post>
    <div class="flex aic jb gap-x-3 valor-nota">
      {{ form_filtros.valor_minimo.label_tag }}
      {% render_field form_filtros.valor_minimo class="ui-elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
    </div>

    <div class="flex aic jb gap-x-3 valor-nota">
      {{ form_filtros.valor_maximo.label_tag }}
      {% render_field form_filtros.valor_maximo class="ui-elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
    </div>
  </div>

  <div
    class="flex gap-x-3 flex aic [&_label]:min-w-max"
    hx-vals="{ 'solo_tabla': true }"
  >
    {{ form_filtros.cantidad_por_pagina.label_tag }}
    {% render_field form_filtros.cantidad_por_pagina class="ui-elevado-2 py-0! incluido-filtros" style="max-width: 6ch;" hx-trigger="input changed delay:600ms" hx-post="" %}
  </div>
{% endpartialdef config %}
