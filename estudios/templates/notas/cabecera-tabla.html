{% load widget_tweaks %}
{% load grupos_variantes %}

<header
  class="flex gap-x-1"
  hx-target="#tabla-y-paginacion"
  hx-indicator="#indicador-busqueda"
  hx-include=".incluido-filtros"
>
  <button
    class="btn elevado w-9 h-full min-[600px]:hidden"
    type="button"
    id="ver-filtros"
    @click="filtros_abiertos = !filtros_abiertos"
    aria-expanded="filtros_abiertos"
    aria-label="Ver filtros"
    aria-haspopup="menu"
  >
    {% include "notas/iconos.html#filtros" %}
  </button>

  <details
    class="menu z-4 [&_details[open]]:z-4 w-9 h-full [&_label]:text-texto-sutil"
    id="busqueda-config"
  >
    <summary
      class="btn elevado w-9 h-full"
      aria-label="configuración de búsqueda"
    >
      {% include "notas/iconos.html#config" %}
    </summary>

    <div
      class="{{ 'contenido-menu col gap-y-4 p-3 px-4 rounded-tl-0! top-108% [&_.contenido-menu]:(col gap-y-4) [&_.contenido-menu]:(left-8 top-8 rounded-tl-0) min-[700px]:[&_.contenido-menu]:(left-113% top-0)'|expandir_variantes }}"
    >
      <details
        name="config"
        class="menu submenu"
        hx-post="{% url 'notas_tabla' %}"
        {# se evita que se ejecute la request de "/notas_tabla" al cambiar los filtros específicos de búsqueda cuando el campo de búsqueda está vacío, ya que no tendría sentido, pues los resultados serían los mismos #}
        hx-trigger="change[$id('q').value.trim() !== ''] changed delay:600ms"
      >
        <summary class="flex aic gap-x-2">
          {% include "componentes/iconos/caret.html#izquierda" with class="size-5" %}
          Búsqueda
        </summary>

        <div class="contenido-menu p-4">
          <div class="col gap-y-1">
            {{ form.notas_tipo_busqueda.label_tag }}
            {% render_field form.notas_tipo_busqueda class="elevado-2 incluido-filtros" %}
          </div>

          <div class="col gap-y-1">
            {{ form.notas_columna_buscada.label_tag }}
            {% render_field form.notas_columna_buscada class="elevado-2 incluido-filtros" %}
          </div>
        </div>
      </details>

      <details
        name="config"
        class="menu submenu"
        hx-post="{% url 'notas_tabla' %}"
        hx-trigger="input changed delay:600ms"
      >
        <summary class="flex aic gap-x-2">
          {% include "componentes/iconos/caret.html#izquierda" with class="size-5" %}
          Valores de las notas
        </summary>

        <div
          class="contenido-menu p-4"
          hx-trigger="change changed"
          hx-include=".incluido-filtros"
          hx-post="{% url 'notas_tabla' %}"
          hx-indicator="#indicador-busqueda"
          hx-target="#tabla-y-paginacion"
        >
          <div class="flex gap-x-3 valor-nota">
            {{ form.notas_valor_minimo.label_tag }}
            {% render_field form.notas_valor_minimo class="elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
          </div>

          <div class="flex gap-x-3 valor-nota">
            {{ form.notas_valor_maximo.label_tag }}
            {% render_field form.notas_valor_maximo class="elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
          </div>
        </div>
      </details>

      <div class="flex gap-x-3 flex aic [&_label]:min-w-max">
        {{ form.notas_cantidad_paginas.label_tag }}
        {% with vals='{"solo_tabla": true}' %}
          {% render_field form.notas_cantidad_paginas class="elevado-2 incluido-filtros" style="max-width: 6ch;" hx-trigger="input changed delay:600ms" hx-post="/notas_tabla/" hx-vals=vals %}
        {% endwith %}
      </div>
    </div>
  </details>

  <input
    id="q"
    name="q"
    class="flex-1 p-[.25rem_.75rem] rounded-campo elevado incluido-filtros"
    type="search"
    hx-post="{% url 'notas_tabla' %}"
    hx-trigger="input changed delay:600ms"
    placeholder="Buscar..."
  />
</header>
