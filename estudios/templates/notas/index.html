{% extends "base.html" %}
{% block titulo %}
  Notas
{% endblock titulo %}
{% load static %}
{% load grupos_variantes %}

{% block cabeza %}
  {# componentes #}
  <link rel="stylesheet" href="{% static 'css/componentes/alerta.css' %}" />
  <link
    rel="stylesheet"
    href="{% static 'css/componentes/decoracion-circular.css' %}"
  />
  <link rel="stylesheet" href="{% static 'css/componentes/tabla.css' %}" />
  <link
    rel="stylesheet"
    href="{% static 'css/componentes/htmx-indicator.css' %}"
  />

  <style>
    @media all and (display-mode: fullscreen) {
      .tabla-contenido {
        padding: 1rem;
        background: var(--color-fondo-300);
      }
    }
  </style>

  <script src="{% static 'js/htmx.min.js' %}"></script>
  <script defer src="{% static 'js/htmx-error-solicitudes.js' %}"></script>
  <script defer src="{% static 'js/htmx-ext-head.js' %}"></script>
  <script src="{% static 'js/componentes/combobox.js' %}"></script>
  <script src="{% static 'js/componentes/tabla-con-fila-sticky.js' %}"></script>
{% endblock cabeza %}

{% block alpine %}
  <script defer src="{% static 'js/alpine-focus.min.js' %}"></script>
  {{ block.super }}
{% endblock alpine %}

{% block contenido %}
  <main
    class="{{ "col gap-y-6 flex-1 size-full supports-[not(height:1dvh)]:(max-h-[calc(100vh-var(--altura-header))] h-[calc(100vh-var(--altura-header))]) max-h-[calc(100dvh-var(--altura-header))] max-w-1000px h-[calc(100dvh-var(--altura-header))] mxa p-4 overflow-y-auto min-[700px]:p-6 min-[1000px]:p-8!" }}"
    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
    hx-include=".incluido-filtros"
    hx-target="#tabla-y-paginacion"
    hx-indicator="#indicador-busqueda"
    hx-swap="outerHTML"
  >
    {% if total < 1 %}
      <div
        id="tabla-y-paginacion"
        role="alert"
        class="ui-caja col aic gap-y-6 max-w-[400px] max-h-max ma flex-1 p-5 px-6 tac text-balance"
      >
        <span
          class="rounded-full aspect-square size-min-[5rem] p-3 bg-primario-50 dark:bg-primario-800 text-primario-600 dark:text-primario-100 [&>svg]:size-full"
        >
          {% include "notas/iconos.html#sin_notas" %}
        </span>

        <hgroup class="col gap-y-2">
          {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
            <h2 class="font-bold text-xl">No se han añadido

              {% if not hay_matriculas %}
                matrículas</h2>
                <p class="text-texto-sutil">
                  estas son necesarias para poder asignar notas
                </p>
              {% elif not hay_materias %}
                asignaturas</h2>
                <p class="text-texto-sutil">
                  estas son necesarias para poder asignar notas
                </p>
                
              {% else %}
                notas</h2>
                <p class="text-texto-sutil">
                  Parece que las actividades escolares no han iniciado
                </p>
              {% endif %}
          {% comment %}<!-- prettier-ignore-end -->{% endcomment %}
        </hgroup>
      </div>
    {% else %}
      <div class="flex flex-wrap gap-2 hidden">
        {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
        {% include "notas/estado.html" with label="Totales" dato=total icono='total' %}

        {% include "notas/estado.html" with label="Filtradas" dato='<span id="conjunto-cantidad" aria-label="cargando">...</span>' icono='conjunto' %}

        {% include "notas/estado.html" with label="Resultados" dato='<span id="resultados-cantidad" aria-label="cargando">...</span>' icono="lupa" %}
      {% comment %}<!-- prettier-ignore-end -->{% endcomment %}
      </div>

      <div class="tabla-contenido col gap-y-2 flex-1 h-full overflow-y-auto">
        {% include "notas/cabecera-tabla.html" %}

        <div
          id="tabla-y-paginacion"
          hx-trigger="load"
          hx-post="{% url 'notas_tabla' %}"
          class="h-full overflow-y-auto"
        >
          <div
            role="alert"
            class="col! aic gap-3 tac p-6 text-texto-sutil text-texto-sutil"
          >
            <div class="ui-loader size-[3em] border-5"></div>
            <h2 class="font-bold text-[1.2rem]">Cargando datos...</h2>
          </div>
        </div>
      </div>
    {% endif %}
  </main>
{% endblock contenido %}
