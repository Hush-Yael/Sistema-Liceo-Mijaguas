{% extends "lista-objetos.html" %}
{% load static %}
{% load partials %}
{% load utilidades %}
{% load widget_tweaks %}
{% load grupos_variantes %}

{% block cabeza %}
  {{ block.super }}
  {% include "componentes/combobox.html#scripts" %}
  {% include "lista-objetos.html#script_fn_verificar_click_reiniciar" %}
{% endblock cabeza %}

{% block contenido %}
  {%
    with
    main_class='col gap-y-4 flex-1 size-full supports-[not(height:1dvh)]:(max-h-[calc(100vh-var(--altura-header))] h-[calc(100vh-var(--altura-header))]) max-h-[calc(100dvh-var(--altura-header))] max-w-1000px h-[calc(100dvh-var(--altura-header))] mxa p-4 overflow-y-auto min-[600px]:p-5 min-[700px]:p-6 min-[1000px]:p-8!'|expandir_variantes
    nombre_url_crear='crear_nota'
  %}
    {{ block.super }}
  {% endwith %}
{% endblock contenido %}

{% block filtros %}
  <div
    class="{{ 'col gap-y-2 gap-x-5 min-[600px]:(flex-row)'|expandir_variantes }}"
  >
    <form
      class="{{ 'flex flex-wrap gap-2 min-[600px]:(aic content-center)'|expandir_variantes }}"
      hx-trigger="click[verificarClickEnReiniciar()], change delay:800ms"
      hx-post
    >
      {%
        with
        class="min-[500px]:min-w-150px incluido-filtros"
        prefijo_class="text-texto-sutil"
        btn_class="max-[500px]:text-xs"
        label_class="sr-only"
        valor_class="font-bold"
        placeholder="cualquiera"
        busqueda_activa=1
      %}
        {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
          {% include "componentes/combobox.html" with
            name=form_filtros.materias.name
            label=form_filtros.materias.label
            prefijo=form_filtros.materias.label
            opciones=form_filtros.materias|obtener_lista_opciones
            opciones_seleccionadas=form_filtros.materias.value
            mostrar_cantidad=1
          %}

          {% include "componentes/combobox.html" with
            name=form_filtros.secciones.name
            label=form_filtros.secciones.label
            prefijo=form_filtros.secciones.label
            opciones=form_filtros.secciones.field.choices|obtener_lista_opciones
            opciones_seleccionadas=form_filtros.secciones.value
            lista_clase="left-unset right-0"
            mostrar_cantidad=1
          %}

          {% include "componentes/combobox.html" with
            name=form_filtros.lapsos.name
            label=form_filtros.lapsos.label
            prefijo=form_filtros.lapsos.label
            opciones=form_filtros.lapsos.field.choices|obtener_lista_opciones
            opciones_seleccionadas=form_filtros.lapsos.value
            lista_clase="left-unset right-0"
            mostrar_cantidad=1
          %}
        {% comment %}<!-- prettier-ignore-end -->{% endcomment %}
      {% endwith %}
    </form>
  </div>
  {{ block.super }}
{% endblock filtros %}

{% block menu_config %}
  <div
    class="col gap-y-4"
    hx-post
    {# se evita que se ejecute la request de "/notas" al cambiar los filtros específicos de búsqueda cuando el campo de búsqueda está vacío, ya que no tendría sentido, pues los resultados serían los mismos #}
    hx-trigger="change[$id('q').value.trim() !== ''] changed delay:600ms"
  >
    <div class="col gap-y-1">
      {{ form_filtros.columna_buscada.label_tag }}
      {% render_field form_filtros.columna_buscada class="ui-elevado-2 incluido-filtros" %}
    </div>

    <div class="col gap-y-1">
      {{ form_filtros.tipo_busqueda.label_tag }}
      {% render_field form_filtros.tipo_busqueda class="ui-elevado-2 incluido-filtros" %}
    </div>
  </div>

  <div class="col gap-y-4" hx-trigger="change changed" hx-post>
    <div class="flex aic jb gap-x-3 valor-nota">
      {{ form_filtros.valor_minimo.label_tag }}
      {% render_field form_filtros.valor_minimo class="ui-elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
    </div>

    <div class="flex aic jb gap-x-3 valor-nota">
      {{ form_filtros.valor_maximo.label_tag }}
      {% render_field form_filtros.valor_maximo class="ui-elevado-2 py-0! incluido-filtros" style="width: 6ch;" %}
    </div>
  </div>

  <div
    class="flex gap-x-3 flex aic [&_label]:min-w-max"
    hx-vals="{ 'solo_tabla': true }"
  >
    {{ form_filtros.cantidad_por_pagina.label_tag }}
    {% render_field form_filtros.cantidad_por_pagina class="ui-elevado-2 py-0! incluido-filtros" %}
  </div>
{% endblock menu_config %}

{% partialdef tabla %}
  {% include "lista-objetos.html#tabla" %}
{% endpartialdef tabla %}

{% block sin_resultados %}
  {% comment %}<!-- prettier-ignore-start -->{% endcomment %}
    <h2 class="font-bold text-xl">No se han añadido

      {% if not hay_matriculas %}
        matrículas</h2>
        <p class="text-texto-sutil">
          estas son necesarias para poder asignar notas
        </p>
      {% elif not hay_materias %}
        asignaturas</h2>
        <p class="text-texto-sutil">
          estas son necesarias para poder asignar notas
        </p>
        
      {% else %}
        notas</h2>
        <p class="text-texto-sutil">
          Parece que las actividades escolares no han iniciado
        </p>
      {% endif %}
  {% comment %}<!-- prettier-ignore-end -->{% endcomment %}
{% endblock sin_resultados %}

{% partialdef datos_td %}
  {% if clave == 'valor' %}
    {% with valor=dato|floatformat:"-1" %}
      {{ valor }}
    {% endwith %}
  {% elif 'fecha' in columna.clave %}
    {{ dato|date:"D. d M. Y, h:i A" }}
  {% else %}
    {{ dato }}
  {% endif %}
{% endpartialdef datos_td %}

{% partialdef acciones %}
{% endpartialdef acciones %}
