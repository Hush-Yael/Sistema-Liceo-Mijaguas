{% extends "base.html" %}

{% block titulo %}Perfil{% endblock titulo %}
{% load static %}
{% load widget_tweaks %}
{% load grupos_variantes %}
{% load partials %}

{% block cabeza %}
  <link
    rel="stylesheet"
    href="{% static 'css/componentes/htmx-indicator.css' %}"
  />
  <link rel="stylesheet" href="{% static 'css/componentes/dialog.css' %}" />

  <script defer src="{% static 'js/htmx.min.js' %}"></script>
  <script defer src="{% static 'js/htmx-error-solicitudes.js' %}"></script>

  {% if form.errors %}
    <script defer src="{% static 'js/limpiar-errores.js' %}"></script>
  {% endif %}
{% endblock cabeza %}

{% block contenido %}
  <main
    class="{{ 'col gap-y-6 flex-1 w-full max-w-700px m-[0_auto] p-5 py-6 min-[500px]:p-8'|expandir_variantes }}"
    x-data='{ pestaña: "datos" }'
    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
  >
    <h1 class="flex jb aic gap-x-4 font-bold text-2xl">
      Configuración del perfil
      <span
        class="ui-contenedor-icono bg-[--transparente-1] dark:bg-[--transparente-2] text-texto-sutil size-8 p-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
          <path
            d="M144 128a80 80 0 1 1 160 0 80 80 0 1 1-160 0zm208 0a128 128 0 1 0-256 0 128 128 0 1 0 256 0zM48 480c0-70.7 57.3-128 128-128h96c70.7 0 128 57.3 128 128v8c0 13.3 10.7 24 24 24s24-10.7 24-24v-8c0-97.2-78.8-176-176-176h-96C78.8 304 0 382.8 0 480v8c0 13.3 10.7 24 24 24s24-10.7 24-24v-8z"
          ></path>
        </svg>
      </span>
    </h1>

    {%
      include "componentes/pestañas.html" with
      lista='[{"label": "Detalles","id": "datos"}, {"label": "Cambiar contraseña","id": "contraseña"}]'
    %}

    {% partialdef datos inline %}
      {% with pestaña='datos' %}
        {% if 'accion' in request.POST %}
          {%
            include "perfil/form-datos.html"
            with respuesta=1
          %}
        {% else %}
          {%
            include "perfil/form-datos.html"
            with form=forms.datos
          %}
        {% endif %}
      {% endwith %}
    {% endpartialdef datos %}

    {% partialdef contraseña inline %}
      {% with pestaña='contraseña' %}
        {% if 'accion' in request.POST %}
          {% include "perfil/cambiar-contraseña.html" with respuesta=1 %}
        {% else %}
          {% include "perfil/cambiar-contraseña.html" with form=forms.contraseña %}
        {% endif %}
      {% endwith %}
    {% endpartialdef contraseña %}
  </main>
{% endblock contenido %}
